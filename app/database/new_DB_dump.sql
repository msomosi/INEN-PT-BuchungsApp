-- Initial structure setup
SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';
SET default_table_access_method = heap;

-- Tables in correct order
CREATE TABLE public.role (
    role_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    role_name VARCHAR(50)
);

ALTER TABLE public.role OWNER TO ubuntu;

CREATE TABLE public.contact (
    kontakt_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    address VARCHAR(50),
    postal_code NUMERIC(4,0),
    location VARCHAR(50),
    phone VARCHAR(20)
);

ALTER TABLE public.contact OWNER TO ubuntu;

CREATE TABLE public.booking_state (
    state_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    state_name VARCHAR(25)
);

ALTER TABLE public.booking_state OWNER TO ubuntu;

CREATE TABLE public.university (
    university_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    university_name VARCHAR(50),
    contact_id INTEGER NOT NULL,
    FOREIGN KEY (contact_id) REFERENCES public.contact(kontakt_id)
);

ALTER TABLE public.university OWNER TO ubuntu;

CREATE TABLE public.accommodation (
    provider_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    contact_id INTEGER NOT NULL,
    company_name VARCHAR(50),
    parking BOOLEAN,
    parking_free BOOLEAN,
    free_notice VARCHAR(500),
    FOREIGN KEY (contact_id) REFERENCES public.contact(kontakt_id)
);

ALTER TABLE public.accommodation OWNER TO ubuntu;

CREATE TABLE public."user" (
    user_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    role_id INTEGER NOT NULL,
    provider_id INTEGER NOT NULL,
    verification BOOLEAN,
    verification_date DATE,
    email VARCHAR(50),
    oauth_token VARCHAR(100),
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    FOREIGN KEY (role_id) REFERENCES public.role(role_id),
    FOREIGN KEY (provider_id) REFERENCES public.accommodation(provider_id)
);

ALTER TABLE public."user" OWNER TO ubuntu;

CREATE TABLE public.student (
    user_id INTEGER PRIMARY KEY,
    contact_id INTEGER NOT NULL,
    student_number VARCHAR(20),
    university_id INTEGER NOT NULL,
    enrollment_end DATE,
    FOREIGN KEY (user_id) REFERENCES public."user"(user_id),
    FOREIGN KEY (contact_id) REFERENCES public.contact(kontakt_id),
    FOREIGN KEY (university_id) REFERENCES public.university(university_id)
);

ALTER TABLE public.student OWNER TO ubuntu;

CREATE TABLE public.room (
    room_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    user_id INTEGER NOT NULL,
    date_from DATE,
    date_to DATE,
    state_id INTEGER NOT NULL DEFAULT 1,
    FOREIGN KEY (user_id) REFERENCES public."user"(user_id),
    FOREIGN KEY (state_id) REFERENCES public.booking_state(state_id)
);

ALTER TABLE public.room OWNER TO ubuntu;

CREATE TABLE public.booking (
    booking_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    user_id INTEGER NOT NULL,
    room_id INTEGER NOT NULL,
    date_from DATE,
    date_to DATE,
    state_id INTEGER NOT NULL,
    FOREIGN KEY (user_id) REFERENCES public."user"(user_id),
    FOREIGN KEY (room_id) REFERENCES public.room(room_id),
    FOREIGN KEY (state_id) REFERENCES public.booking_state(state_id)
);

ALTER TABLE public.booking OWNER TO ubuntu;

-- Data loading using COPY
COPY public.contact (kontakt_id, address, postal_code, location, phone) FROM stdin;
1	Campus 2	7000	Eisenstadt	0126485682
2	Rechbauerstra√üe 12	8010	Graz	06642158713365
3	Student Address	1010	Vienna	06641234567
\.

COPY public.role (role_id, role_name) FROM stdin;
1	admin
2	provider
3	student
\.

COPY public.booking_state (state_id, state_name) FROM stdin;
1	available
2	pending
3	confirmed
4	completed
5	failed
\.

COPY public.university (university_id, university_name, contact_id) FROM stdin;
1	FH Burgenland	1
2	TU Graz	2
3	University of Vienna	3
\.

COPY public.accommodation (provider_id, contact_id, company_name, parking, parking_free, free_notice) FROM stdin;
1	1	OEJAB Eisenstadt	t	t	
2	2	Hotel A	f	f	
\.

COPY public."user" (user_id, role_id, provider_id, verification, verification_date, email, oauth_token, first_name, last_name) FROM stdin;
1	2	1	t	2024-11-20	oejab_eisenstadt	\N	Franz	Hilber
2	2	2	t	2024-11-20	hotela	\N	Igraine	OhneZahn
3	3	1	t	2024-11-20	tbaier	\N	Tatjana	Baier
\.

COPY public.student (user_id, contact_id, student_number, university_id, enrollment_end) FROM stdin;
3	3	2024001	1	2025-09-30
\.

COPY public.room (room_id, user_id, date_from, date_to, state_id) FROM stdin;
2	1	2024-11-25	\N	1
4	1	2024-11-26	\N	1
5	1	2024-11-27	\N	1
7	1	2024-11-29	\N	1
8	1	2024-11-30	\N	1
6	1	2024-11-27	\N	2
9	1	2024-12-23	\N	1
10	1	2025-01-06	\N	1
11	1	2025-01-06	\N	1
13	1	2025-01-07	\N	1
14	1	2025-01-20	\N	1
15	1	2025-01-21	\N	1
16	1	2025-01-22	\N	1
17	1	2025-01-23	\N	1
18	1	2025-01-24	\N	1
19	2	2025-02-03	\N	1
20	2	2025-02-04	\N	1
21	2	2025-02-05	\N	1
1	1	2024-11-25	\N	2
3	1	2024-11-26	\N	2
12	1	2025-01-07	\N	2
23	1	2024-11-21	\N	1
24	1	2024-11-22	\N	1
25	1	2024-11-22	\N	1
26	1	2025-02-03	\N	2
27	1	2024-11-29	\N	1
28	1	2024-11-30	\N	1
22	1	2024-11-21	\N	2
29	2	2024-11-25	\N	1
\.

COPY public.booking (booking_id, user_id, room_id, date_from, date_to, state_id) FROM stdin;
1	3	1	2024-11-25	2024-12-25	3
2	3	3	2024-11-26	2024-12-26	2
\.

-- Reset sequences
SELECT pg_catalog.setval('public.role_role_id_seq', 3, true);
SELECT pg_catalog.setval('public.contact_kontakt_id_seq', 3, true);
SELECT pg_catalog.setval('public.accommodation_provider_id_seq', 2, true);
SELECT pg_catalog.setval('public.user_user_id_seq', 3, true);
SELECT pg_catalog.setval('public.room_room_id_seq', 29, true);
SELECT pg_catalog.setval('public.booking_booking_id_seq', 2, true);
SELECT pg_catalog.setval('public.booking_state_state_id_seq', 5, true);